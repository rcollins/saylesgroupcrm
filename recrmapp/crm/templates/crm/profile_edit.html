{% extends 'crm/base.html' %}
{% block title %}Profile{% endblock %}

{% block content %}
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'crm:home' %}">Dashboard</a></li>
        <li class="breadcrumb-item active">Profile</li>
    </ol>
</nav>

<h1 class="page-title mb-4">Profile</h1>
<p class="text-muted small mb-4">Manage your account: email signature (used when you send emails from the app) and change password.</p>

<div class="card card-crm mb-4">
    <div class="card-header">
        <h5 class="mb-0 section-title">Email signature</h5>
        <p class="section-subtitle mb-0">This HTML is appended to emails you send from the app (clients, contacts, leads, transactions).</p>
    </div>
    <div class="card-body">
        <form method="post" action="{% url 'crm:profile' %}" enctype="multipart/form-data">
            {% csrf_token %}
            {% if form.non_field_errors %}<div class="alert alert-danger">{{ form.non_field_errors }}</div>{% endif %}
            <div class="mb-3">
                <label for="id_email_signature" class="form-label">Signature (HTML)</label>
                <p class="form-text small text-muted mb-2">Use <code>&lt;a href="url"&gt;link text&lt;/a&gt;</code> for links and <code>&lt;img src="https://..." alt="..."&gt;</code> for images (use a full image URL).</p>
                <textarea name="email_signature" class="form-control font-monospace" rows="8" id="id_email_signature" placeholder="e.g. &lt;p&gt;Best regards,&lt;br&gt;{{ user.get_username }}&lt;/p&gt;">{% if form.email_signature.value %}{{ form.email_signature.value }}{% else %}{{ form.initial.email_signature|default:"" }}{% endif %}</textarea>
                {% if form.email_signature.errors %}<div class="invalid-feedback d-block">{{ form.email_signature.errors }}</div>{% endif %}
            </div>
            <div class="mb-3">
                <label for="id_signature_image" class="form-label">Signature image (optional)</label>
                <p class="form-text small text-muted mb-2">Upload an image (e.g. logo or headshot) to show at the end of your signature.</p>
                <input type="file" name="signature_image" class="form-control" id="id_signature_image" accept="image/*">
                {% if form.instance.signature_image %}
                <p class="small text-muted mt-1 mb-0">Current: <a href="{{ form.instance.signature_image.url }}" target="_blank">View image</a></p>
                <div class="form-check mt-2">
                    <input type="checkbox" name="clear_signature_image" id="id_clear_signature_image" class="form-check-input" value="1">
                    <label class="form-check-label" for="id_clear_signature_image">Remove signature image</label>
                </div>
                {% endif %}
            </div>
            <button type="submit" class="btn btn-crm-primary">Save profile</button>
        </form>
    </div>
</div>

<div class="card card-crm mb-4">
    <div class="card-header">
        <h5 class="mb-0 section-title">Change password</h5>
    </div>
    <div class="card-body">
        <p class="mb-0">Use the link below to change your account password.</p>
        <a href="{% url 'password_change' %}" class="btn btn-outline-primary mt-2"><i class="bi bi-key me-1"></i>Change password</a>
    </div>
</div>
{% endblock %}
